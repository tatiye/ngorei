import tatiyeNet,{
    jsonCode,
    setLink,
    setItemStorage,
    getItemStorage,
    terminalSDK,
    fetchExternal,
    setModal,
    useHandel,useTabelToken}  from "../es6.js"; 
let count = 0;
    export function terminalCommand(selector,data,sso,baseURL='') { 
        var uid=data;
        var uidsso=sso;
        var baseApi=baseURL;
       var cmd = new CommandLine(selector);
       function thelocalstorage(argument) {
              setItemStorage({
                'item' :'terminal',
                'data' :argument
              })
       }
       function routerFetch(key,storage,argument) {
         count++;
           cmd.sText('<div  id="code'+count+'"></div>');
           cmd.startNewCommand();  
        var db=fetchExternal({
                "url"    :storage[2],
                "element":'element',
                "method ":storage[1],
                "records":2,
                "page"   :1,
                "keywords":''
            })
      
         jsonCode(db,'code'+count);
        // ngorei fetch  GET https://jsonplaceholder.typicode.com/photos
       }

       function routerAuth(key='',storage='',argument='') {
         count++;
        // console.log(storage[1])
           cmd.sText('<div id="code'+count+'"></div>');
           cmd.startNewCommand();   

           let dabatabse=useHandel({
                       "token"    :storage[1],
                       "storage"       :{
                          "limit":3,
                          "page":1,
                          "keywords":'',
                          "primaryKey":''
                       }
                    });
               if (storage[2]) {

                var db=dabatabse.storage;
               } else {
                var db=dabatabse;
               }
              if (storage[3]=='query') {
                var storafge=useTabelToken(storage[1]);
               } else {
                var storafge=db;
               }
                jsonCode(storafge,'code'+count)
               

        // ngorei auth eyJkaXIiOiJkZW1vXC9BcGlcLzAuMVwvc2VsZWN0LnBocCIsInVpZCI6MX0  
        // ngorei auth eyJkaXIiOiJkZW1vXC9BcGlcLzAuMVwvc2VsZWN0LnBocCIsInVpZCI6MX0  storage 2
           // body...
       }



// ngorei instal package-1.0.1 demo
// http://192.168.1.112/resquire/general/vendor/tatiye/terminal//index.php
       function router(key,storage,argument) {
         console.log(storage)
         count++;
         var storageKey={
            'primarykey' :key,
            'code' :count,
            'storage' :storage,
         };
         console.log(storageKey)
         console.log(data.router+'/'+argument+'.php')
         console.log(argument)
         // thelocalstorage(storageKey);


        $.ajax({
                 type: 'POST',
                  url: data.router+'/'+argument+'.php',
                  data: 'key='+JSON.stringify(storageKey),
                  beforeSend: function() {   
                 },
                 success: function(response) {
                      if (argument=='json') {
                           cmd.sText('<div  id="code'+count+'"></div>');
                           cmd.startNewCommand();   
                            //var varjs=JSON.stringify(response, null, 10);
                            var add = JSON.parse(response);
                           //var add = JSON.parse(response);
                           jsonCode(add,'code'+count)

                        } else  if (argument=='auth') {
                             cmd.sText(response);
                             routerAuth(key,storage,argument)
                        } else {
                           cmd.sText(response);
                           cmd.startNewCommand();   
                        }

                      if (storage[6]=='query') {
                           cmd.sText('<div  id="code'+count+'"></div>');
                           cmd.startNewCommand();   
                           const external=terminalSDK(storageKey);
                           var token =external['messages'][0]['token'];
                           let dabatabse=useHandel({
                                       "token"    :token,
                                       "storage"       :{
                                          "limit":3,
                                          "page":1,
                                          "keywords":'',
                                          "primaryKey":''
                                       }
                                    });
                            if (storage[7]=='data') {

                               jsonCode(dabatabse,'code'+count)
                            } else {
                               jsonCode(external,'code'+count)

                            }
                        
                            //var varjs=JSON.stringify(response, null, 10);
                            //var add = JSON.parse(external);
                           
                           // ngorei package api file demo  id 27  query data
                      }

                }
            });
       }
       function routerPostleb(key='',storage='',argument='') {
           count++;
          var deseconsole='postleb'+count;
           setModal({
                   'titel':'Postleb Json v1.0.4',
                   'width':'1200px',
                   'key'  :'add',
                   'model':deseconsole,
                   'route':'devices',
                   'tabel':'apppaclicense',
                   'content':'fromAction',
                   'background':'light',
                   'color':'#fff',
                   'element':'postleb',
                   'page'   :1,
                   'setdata' :'public',
                  });
       }


       function routerConsul(key='',storage='',argument='') {
           count++;
          var deseconsole='Console'+count;
           setModal({
                   'titel':'JConsole v1.0.4',
                   'width':'600px',
                   'key'  :'add',
                   'model':deseconsole,
                   'route':'devices',
                   'tabel':'apppaclicense',
                   'content':'fromAction',
                   'background':'light',
                   'color':'#fff',
                   'element':'myconsole',
                   'page'   :1,
                   'setdata' :'public',
                  });
       }

       function routerJson(key) {
         count++;
           cmd.sText('<div id="code'+count+'"></div>');
           cmd.startNewCommand();  
            var add = JSON.parse(JSON.stringify(tatiyeNet));
           jsonCode(add,'code'+count)
       }

  function comenUserInfo(argument,title) {
     if (argument) {
        return cmd.success(argument);
     } else {
        return cmd.error(title +' tidak terdefinisi ');
     }
  }
  function comenUser(argument,segment) {
       var ls={
         "postleb":        ["postleb","Fetch Data Json"],
         "fetch":          ["fetch","Fetch Data External"],
         "auth":           ["auth","Fetch Data Internal"],
         "tabel":          ["tabel","Tabel Api"],
         "create":         ["create","Create Project"],
         "phpv":           ["phpv","Command Prompt"],
         "system":         ["system","Command Prompt"],
         "s":              ["system","Command Prompt"],
         "cmd":            ["system","Command Prompt"],
         "c":              ["system","Console Log"],
         "log":            ["consul","Console Log"],
         "uid":            ["uid","Profil User"],
         "token":          ["token","Profil User"],
         "accesstoken":    ["token","Profil User"],
         "versi":          ["versi","Application Version"],
         "licenced":       ["licenced","Application Lisensi"],
         "json":           ["json","Application Json file"],
         "lisensi":        ["licenced","Application Lisensi"],
         "public":         ["public","Application public"],
         "development":    ["development","Application Development"],
         "package":        ["package","Application Development Package"],
         "dev":            ["development","Application Development"],
         "v":              ["versi","Application Version"],
         "instal":         ["instal","Instal Package"],
         "update":         ["update","Update Package"],
         "delete":         ["delete","Update Package"],
         "i":              ["instal","Instal Package"],
         "u":              ["update","Update Package"],
         "d":              ["delete","Update Package"],
       }
     var infoIf=ls[argument];
     if (infoIf) {
          var infoIf=ls[argument];
     } else {
          var infoIf=[];

     }
   return infoIf;
  }

    /*
    |--------------------------------------------------------------------------
    | Initializes ngorei package api file demo  id 20  query
    |--------------------------------------------------------------------------
    | Develover Tatiye.Net 2020
    | @Date 
    */
    cmd.addCommand("ngorei ls",function(command){
       var add=command.arguments.ls;
       var title=command.commandSegments[1];
       var comond=comenUser(add,title);
         comenUserInfo(comond[1],add);
         if(comond[0]) {
            if (comond[0]=='json') {
                router(comond[0],command.commandSegments,'json')
            } else if (comond[0]=='fetch') {
                routerFetch(comond[0],command.commandSegments,'index')
            } else if (comond[0]=='auth') {
                routerAuth(comond[0],command.commandSegments,'index')
            } else if (comond[0]=='postleb') {
                routerPostleb(comond[0],command.commandSegments,'index')
            } else {
                // cmd.warning(command.commandSegments);
                router(comond[0],command.commandSegments,'index')
            }
         } else {
             cmd.warning('Tidak dapat membaca properti yang tidak terdefinisi ');
         }
         
   },'Tatiye Ngorei ls');



// ngorei instal package-1.0.1 demo



   /*
    |--------------------------------------------------------------------------
    | Initializes tatiyeNet URL DATA
    |--------------------------------------------------------------------------
    | Develover Tatiye.Net 2020
    | @Date 
    */
    cmd.addCommand("terminal ls",function(command){
              var title=command.commandSegments[0];
              if (title=='s') {
                var header='Terminal Show';
                Cookies.set('tc', 1, { expires: 10000});
              } else {
                var header='Terminal Hide';
                Cookies.set('tc', '', { expires: 10000});
                  location.reload();
              }
               cmd.success(header);
               cmd.startNewCommand(); 
    },'termina Status');
    cmd.addCommand("log ls",function(command){
      var add=command.arguments.ls;
       var title=command.commandSegments[1];
       var comond=comenUser(add,title);
         comenUserInfo(comond[1],add);
         if(comond[0]) {
            if (comond[0]=='json') {
                router(comond[0],command.commandSegments,'json')
            } else {
                router(comond[0],command.commandSegments,'index')
            }
         } else {
             cmd.warning('Tidak dapat membaca properti yang tidak terdefinisi ');
         }
             
       },'Console Log');
    /*
    |--------------------------------------------------------------------------
    | Initializes tatiyeNet URL DATA
    |--------------------------------------------------------------------------
    | Develover Tatiye.Net 2020
    | @Date 
    */
    cmd.addCommand("postleb",function(command){
              // var title=command.commandSegments[0];
                 cmd.success('Postleb Json v1.0.4');
              routerPostleb('title')
    },'Postleb Json');



    cmd.addCommand("consul",function(command){
              // var title=command.commandSegments[0];
                 cmd.success('JConsole v1.0.4');
              routerConsul('Ngorei Console')
    },'Console Log');



    /*
    |--------------------------------------------------------------------------
    | Initializes tatiyeNet URL DATA
    |--------------------------------------------------------------------------
    | Develover Tatiye.Net 2020
    | @Date 
    */
    cmd.addCommand("net",function(command){
              var title=command.commandSegments[0];
              routerJson(title)
    },'Console Log');
    /*
    |--------------------------------------------------------------------------
    | Initializes tatiyeNet URL DATA
    |--------------------------------------------------------------------------
    | Develover Tatiye.Net 2020
    | @Date 
    */
    cmd.addCommand("php v",function(command){
              router('phpv','phpv','index')
    },'PHP Version');



        cmd.addCommand("login",function(){
            this.prompt("Enter your email: ",function(username){
              if(username !== uidsso.email){
                    cmd.error('Wrong email');
                    this.start();
                } else {
                cmd.secret("Enter your password",function(password){
                    if(password !== 1234){
                        cmd.error('Wrong password');
                        this.start();
                    }else{
                        setTimeout(function(){
                            cmd.info('Authenticating ...');
                            setTimeout(function(){
                                cmd.info('Loading Application ...');
                                setTimeout(function(){
                                    cmd.warning('I am not saving this password! Don\'t worry :)');
                                    setTimeout(function(){
                                        cmd.success('System Ready to use...');
                                        cmd.setUsername(username);
                                        Cookies.set('terminal', 1, { expires: 10000});
                                        cmd.startNewCommand();
                                    },800);
                                },800);
                            },800);


                        },800);
                    }
                });
               }
            });
            return true;
        },'Login by username & password');


        /**
         * Help :)
         */
        cmd.addCommand("help",function(){
            var helpResults = [];
            for(var command = 0;command < this.commands.length;command++){
                helpResults.push(this.commands[command].resolved.getSignature());
                helpResults.push(this.commands[command].description);
            }
            this.list(helpResults,2);
        },"Show available commands");


        cmd.addCommand("logout",function(){
           Cookies.set('terminal', '', { expires: 10000});
            location.reload();
        },'logout terminal');
        /**
         * List all files
         */
        cmd.addCommand("ls",function(){
            this.list([
                'App Version',
                'User Information',
                'Lisensi',
                'Users',
                'Component',
                'Package',
                'Package Lisensi',
                'Tabel Api',
                'Token',
                'System'
            ]);
        },'List directory files');


        /**
         * List all files
         */
        cmd.addCommand("date",function(){
            this.output(new Date());
            this.commandRow.hideTime();
        },'show current DateTime');


        /**
         * Show current user
         */
        cmd.addCommand("whoami",function(){
            this.output(this.username);
            this.commandRow.hideTime();
        },'show current Username');


        /**
         * Show current user
         */
        cmd.addCommand("shortcuts",function(){
            this.list([
                'Ctrl + c :  Cancel Command',
                'Ctrl + r :  Clear Screen',
                'Arrow up :  Previous command',
                'Arrow Down :  Next Command',
                'Tab :  Autocomplete command'
            ],1);
        },'Show keyboard short cuts');

        return cmd;
    };

