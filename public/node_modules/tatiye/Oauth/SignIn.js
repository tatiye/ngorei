import tatiyeNet,{getToken,useHandelIDTabel,userAgent,setToken,Qrcode}  from "../es6.js";
  if (Cookies.get("sso")) {
      var newtoken=Cookies.get("sso");
      var row=getToken(newtoken);

      if (row.applogin=='Standby') {
        var desain=` 
        <div class="list-group-item d-flex align-items-center mb-10px ">
              <img src="${row.avatar}" class="wd-30 ht-30 rounded-circle mg-r-15" alt="">
            <div>
              <h6 class="tx-13 tx-inverse tx-semibold mg-b-0">${row.name}</h6>
              <span class="d-block tx-11 text-muted">Login Standby</span>
            </div>
         </div>`;
         $("#appLogin").html(desain);
      } else if (row.applogin=='Qr') {
          // var agent=userAgent({'indexOn':'Desktop'})
          // //console.log(agent.ipaddress)
          // var newTokenQr=setToken({
          //   tm:agent.tim,
          //   domain:agent.ipaddress,
          // });   
          // Qrcode(newTokenQr,{
          //     selector:'qrcodeuser',
          //     color:'#000',
          //     size:'200',
          //   });
      } else {

      } 
  } else {

    
  }

const appLogin = function() {

  var desain=`
         <button  class="btn btn-brand-02 btn-block"disabled>
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Loading...
         </button>
        `;
	   const info = document.getElementById("oauthAccountInfo");
	   const oauthAccount = document.getElementById("oauthAccount").style.display = "none";
	   info.innerHTML=desain;
         if (Cookies.get("sso")) {
              if (row.applogin=='Standby') {
                   var oauth_uid=row.email;
                   var oauth_pws=$('input[name=oauth_pws]').val();
              } else if (row.applogin=="Serial") {
                   var oauth_serial=$('input[name=oauth_pws]').val();    
                if (row.serialKey== oauth_serial) {
                   var rowsetIData =useHandelIDTabel('appuserprofil,'+row.userid);
                    var oauth_uid=row.email;
                    var oauth_pws=rowsetIData.password;  
                } else {
                    var oauth_uid='error';
                    var oauth_pws='error';    
                }

              } else if (row.applogin=='Qr') {

              } else {
                    var oauth_uid=$('input[name=oauth_uid]').val();
                    var oauth_pws=$('input[name=oauth_pws]').val();    
              } 
          } else {
              var oauth_uid=$('input[name=oauth_uid]').val();
              var oauth_pws=$('input[name=oauth_pws]').val();
          }
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        var raw = JSON.stringify({
          "username": oauth_uid,
          "password":oauth_pws
        });
        var requestOptions = {
          method: 'POST',
          headers: myHeaders,
          body: raw,
          redirect: 'follow'
        };
        fetch(tatiyeNet.api+"/login", requestOptions)
          .then(response => response.text())
            .then((response)=>{
            	   const oauthAccount = document.getElementById("oauthAccount").style.display = "block";
                   var add = JSON.parse(response);
                   if (add.data !==null) {
                      Cookies.set('hostName',    add.data.sub_domain, { expires: 10000});
                      window.location.href =add.data.sub_domain;
                      // console.log(response)
                      // console.log(add.data.uid)
                      info.innerHTML='';
                   } else {
					       	    info.innerHTML=`  
						              <div class="mg-t-20 alert alert-danger d-flex align-items-center" role="alert">
                                  <i data-feather="alert-circle" class="mg-r-10"></i>Credentials nama pengguna atau kata sandi salah
                           </div>
                        `;
                      var status='';
                   }
            })
          .catch(error => console.log('error', error));  
};

     if (Cookies.get("sso")) {
              if (row.applogin=='Standby') {
                    const Login = document.getElementById('oauthAccount');
                    Login.addEventListener('click', appLogin);
              } else if (row.applogin=="Serial") {
                   const Login = document.getElementById('oauthAccount');
                   Login.addEventListener('click', appLogin);
              } else if (row.applogin=='Qr') {

              } else {
                     const Login = document.getElementById('oauthAccount');
                     Login.addEventListener('click', appLogin);  
              } 
          } else {
              const Login = document.getElementById('oauthAccount');
              Login.addEventListener('click', appLogin);
          }






