import tatiyeNet  from "./es6.js";
const AppOauth = () => {
       var desain=`
         <button  class="btn btn-brand-02 btn-block"disabled>
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Loading...
         </button>
        `;
	   const info = document.getElementById("oauthAccountInfo");
	   const oauthAccount = document.getElementById("oauthAccount").style.display = "none";
	   info.innerHTML=desain;
        var oauth_uid=$('input[name=oauth_uid]').val();
        var oauth_pws=$('input[name=oauth_pws]').val();
        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        var raw = JSON.stringify({
          "username": oauth_uid,
          "password":oauth_pws
        });
        var requestOptions = {
          method: 'POST',
          headers: myHeaders,
          body: raw,
          redirect: 'follow'
        };
        fetch(tatiyeNet.api+"/login", requestOptions)
          .then(response => response.text())
            .then((response)=>{
            	   const oauthAccount = document.getElementById("oauthAccount").style.display = "block";
                   var add = JSON.parse(response);
                   if (add.data !==null) {
                      var status=add.data.access_token;
                      var user_id=add.data.user_id;
                      Cookies.set('user_id', user_id, { expires: 10000});
                      Cookies.set('uid', status, { expires: 10000});
                      Cookies.set('hostName', add.data.sub_domain, { expires: 10000});
                      window.location.href =add.data.sub_domain;
                      info.innerHTML='';
                   } else {
                      Cookies.set('uid', '', { expires: 10000});
                      Cookies.set('user_id', '', { expires: 10000});
					       	    info.innerHTML=`  
						              <div class="mg-t-20 alert alert-danger d-flex align-items-center" role="alert">
                                  <i data-feather="alert-circle" class="mg-r-10"></i>Credentials nama pengguna atau kata sandi salah
                           </div>
                        `;
                      var status='';
                   }
            })
          .catch(error => console.log('error', error));    	 
};
export default AppOauth;