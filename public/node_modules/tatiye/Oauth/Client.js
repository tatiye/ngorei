import tatiyeNet,{getToken,useHandelIDTabel,userAgent,setToken,Qrcode}  from "../es6.js";
export function Client(property,atribut) {
  console.log(property)
      if (property[1]=='SignUp') {
        var template=`
          <div class="sign-wrappermg-xl-l-60">
            <div class="wd-100p">
              <h3 class="tx-color-01 mg-b-5">Buat akun baru</h3>
              <p class="tx-color-03 tx-16 mg-b-20">Pendaftarannya  hanya membutuhkan waktu satu menit.</p>
          <div id="oauthAccountInfo"></div>
              <div class="form-group mg-b-20">
                <label>Nama Lengkap</label>
                <input type="text" name="oauth_name"class="form-control" placeholder="Full Name">
              </div>
              <div class="form-group mg-b-20">
                <label>Email address</label>
                <input type="email" name="oauth_uid"class="form-control" placeholder="yourname@yourmail.com">
              </div>
              <div class="form-group mg-b-20">
                <div class="d-flex justify-content-between mg-b-5">
                  <label class="mg-b-0-f">Password</label>
                </div>
                <input type="password" name="oauth_pws"class="form-control" placeholder="Enter your password">
              </div>
              <div class="form-group mg-b-20">
                <div class="d-flex justify-content-between mg-b-5">
                  <label class="mg-b-0-f">Confirmasi Password</label>
                </div>
                <input type="password" name="oauth_confirmasi"class="form-control" placeholder="Enter your password">
              </div>
              <button onclick="useClientOauth(['SignUp']);" class="btn btn-brand-02 mg-t-20 btn-block">Mendaftar</button>
             
            </div>
        `;
    } else {

     var template=`
<div class="sign-wrapper">
<div class="wd-100p">
              <h3 class="tx-color-01 mg-b-5">Masuk</h3>
              <p class="tx-color-03 tx-16 mg-b-20">Selamat Datang kembali! Silahkan masuk untuk melanjutkan.</p>
              <h1 id="app"></h1>

              <div class="form-group mg-b-20">
                <label>Email address</label>
                <input type="email" name="oauth_uid"class="form-control" placeholder="yourname@yourmail.com">
              </div>
              <div class="form-group mg-b-20">
                <div class="d-flex justify-content-between mg-b-5">
                  <label class="mg-b-0-f">Password</label>
                  <a href="" class="tx-13">Forgot password?</a>
                </div>
                <input type="password" name="oauth_pws"class="form-control" placeholder="Enter your password">
              </div>
              <button onclick="useClientOauth(['SignIn']);" class="btn btn-brand-02 mg-t-20 btn-block" id="oauthAccount">Masuk</button>
              <div id="oauthAccountInfo"></div>
  </div>

     `;
    }
    $("#body"+atribut).html(template)
}

 window.useClientOauth=function (property) {
  if (property[0]=='SignUp') {
    var desain=`
         <button  class="btn btn-brand-02 btn-block"disabled>
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Loading...
         </button>
        `;

       const info = document.getElementById("oauthAccountInfo");
        var oauth_uid=$('input[name=oauth_uid]').val();
        var oauth_pws=$('input[name=oauth_pws]').val();
        var oauth_name=$('input[name=oauth_name]').val();
        var oauth_confirmasi=$('input[name=oauth_confirmasi]').val();
var myHeaders = new Headers();
myHeaders.append("Authorization", tatiyeNet.token);
myHeaders.append("Content-Type", "application/json");
myHeaders.append("Cookie", "PHPSESSID=1b15sq9hm3ct7ohk2u1mdkgnc1");

var raw = JSON.stringify({
  "fullname":   oauth_name,
  "username":   oauth_uid,
  "password":   oauth_pws,
  "confirmasi": oauth_confirmasi

});

var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: raw,
  redirect: 'follow'
};

fetch(tatiyeNet.api+"/registrasi", requestOptions)
  .then(response => response.json())
  .then(result =>{
    if (result.messages[0] !=='success') {
    info.innerHTML=`  
        <div class="mg-t-20 alert alert-danger d-flex align-items-center" role="alert">
                <i data-feather="alert-circle" class="mg-r-10"></i>${result.messages[0]}
         </div>
      `;
    } else {
     info.innerHTML=`  
        <div class="mg-t-20 alert alert-success d-flex align-items-center" role="alert">
                <i data-feather="alert-circle" class="mg-r-10"></i>Sukses mendaftar
         </div>
      `;  
       $('input[type="text"],select, textarea').val('');//kosongkan form
       $('input[type="email"],select,form textarea').val('');//kosongkan form
       $('input[type="password"], select, textarea').val('');//kosongkan form
       $('input[type="radio"]').prop('checked', false); 
       $('input[type="checkbox"]').prop('checked', false); 
       $("#success").html(result.data.fullname);
    }
     // $("#oauthAccountInfo").text(result.messages[0]);
     console.log(result.messages[0])
  })
  .catch(error => console.log('error', error));
  } else {
              var oauth_uid=$('input[name=oauth_uid]').val();
              var oauth_pws=$('input[name=oauth_pws]').val();

  var desain=`
         <button  class="btn btn-brand-02 btn-block"disabled>
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Loading...
         </button>
        `;
     const info = document.getElementById("oauthAccountInfo");
     const oauthAccount = document.getElementById("oauthAccount").style.display = "none";
     info.innerHTML=desain;

        var myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");
        var raw = JSON.stringify({
          "username": oauth_uid,
          "password":oauth_pws
        });
        var requestOptions = {
          method: 'POST',
          headers: myHeaders,
          body: raw,
          redirect: 'follow'
        };
        fetch(tatiyeNet.api+"/login", requestOptions)
          .then(response => response.text())
            .then((response)=>{
               
                   var add = JSON.parse(response);
                   if (add.data !==null) {
                      Cookies.set('hostName',    add.data.sub_domain, { expires: 10000});
                      location.reload(true);
                      // console.log(response)
                      // console.log(add.data.uid)
                      info.innerHTML='';
                   } else {
                      info.innerHTML=`  
                          <div class="mg-t-20 alert alert-danger d-flex align-items-center" role="alert">
                                  <i data-feather="alert-circle" class="mg-r-10"></i>Credentials nama pengguna atau kata sandi salah
                           </div>
                        `;
                      var status='';
                   }
            })
          .catch(error => console.log('error', error));  
 
  }
 }
