$(function($){
   $.fn.tatiyeNetAppTable = function(e){
      var tableObj   =$(this);
      var muId       =$(this).attr('id');
      if (e.status=='development') {
         var myFrom     ='helper/Assets/form/customTabel';
         $.post(autoload,{
                 etc          :myFrom,
                 storage      :e.tabel,
                })
               .done(function (data) {
              //$(tableObj).html(data);  
          });
      } else { 

          var setRoute= setToken({
                  "route":e.tabel,
                  "mydiv":muId,
                 
          });


           var appData='';
            appData=`
            <div id="fromAction_${muId}"></div>
            <table id="${muId}" class="table"><thead><tr>`;
           $.each(e.tableHead,function(key,value){
              if (value=='No') {
                $sty='style="width: 40px;"';
              } else {
                 $sty='';
              }
              var desainTabel=`<th ${$sty} id="${value}">${value}</th>`;
              appData+=desainTabel;
           });
           appData +=`</tr></thead><tfoot align="right"><tr>`;
           $.each(e.tableHead,function(key,value){
               var desainTabel=`<td class="text-right"></td>`;
                appData+=desainTabel;
            });
            appData +=`</tr></tfoot></table>`;
            $(tableObj).before(appData);
      }
      if(e.sheet ==true) {
           var my_array = [];
           $.each(e.sheetData,function(key, set){
              my_array.push({
                    extend: 'colvisGroup',
                    text: '<span class="tdText"><i class="picons-180"></i> <span id="tText">'+key+'</span></span>',
                    show: set['show'],
                    hide: set['hide'],
                   });
                  
           });
           // $("#nugi").html(JSON.stringify(my_array, null, 10));

          var sheetData=my_array;

        } else {
          sheetData=[];
        }
          var settings={
                 "autoload"     :hostName+"/api/"+e.tabel,
                 "tabel"        :e.tabel,
                 "ById"         :muId,
                 "fileName"     :e.fileName,
                 'setRoute'    :setRoute,
                 "extend"     :[     
                 {   
                     "extend": 'pdfHtml5',
                     "filename": e.fileNamee,
                      "orientation": 'landscape',
                      "pageSize": 'LEGAL',
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         },
                         
                     }
                 },
                 {   
                     "extend": 'csvHtml5',
                     "filename": e.fileName,
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         }
                     }
                 },
                 {   
                     "extend": 'excelHtml5',
                     "filename": e.fileName,
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         }
                     }
                 },
                 {   
                     "extend": 'print',
                     "filename": e.fileName,
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         }
                     }
                    }, 
                    {
                   'text': '<span class="tdText"><i class="picons-143"></i> <span id="tText">Refresh</span></span>',
                    action: function ( e, dt, node, config ) {
                      $('#'+muId).DataTable().ajax.reload( null, false);
                    }
                 },
                  sheetData,


            ],


           };
           if (e.status=='fromAction') {

          $('#fromAction_'+muId).tatiyeNetAppSelectFrom({
                   label        :false,
                   storage      :{
                     'tabel'   :e.tabel,  
                     'content' :'Outside',   //Outside,QuickSend 
                     'az'      :'tl',  
                     'status'  :'deve',  //development
                   },
                   action      :e.fromAction.action
                   
           });
       }

           return settings;
    }
//  AND tatiyeNetAppDropdown

    /*
    |--------------------------------------------------------------------------
    | Initializes TABEL CRUD 
    |--------------------------------------------------------------------------
    | Develover Tatiye.Net 2020
    | @Date 
    */

    $.fn.tatiyeNetAppTableCrud = function(e){
      var tableObj   =$(this);
      var muId       =$(this).attr('id');
      if (e.status=='development') {
         var myFrom     ='helper/Assets/form/customTabel';
         $.post(autoload,{
                 etc          :myFrom,
                 storage      :e.tabel,
                })
               .done(function (data) {
              //$(tableObj).html(data);  
          });
      } else { 
        if (e.archive==true) {
              //   var template=`
              //     <div id="contextMenu" class="context-menu"display:none">
              //     <div id="contentMenu"></div>
              //     </div>
              // `;
              //  $(tableObj).before(template);
        } else {

        }

         if(e.typeCrud.insert.length==0){
             var myInsertIcon='';
             var myInsertStatus='';
         } else {

             var myInsertIcon='<i class="icon-feather-plus-square"></i> <span id="tText">Insert</span> ';
             var myInsertStatus='Insert';
         }

     if($.isArray(e.colomVisible)) {
          var colomVisible_array = [];
         $.each(e.colomVisible,function(key, set){
            colomVisible_array.push({
               'visible': false, 
               'targets': [set]
            });
         });

         var colomVisible=colomVisible_array;

    } else {
      var colomVisible=[];
    }

        if(e.sheet ==true) {
           var my_array = [];
           $.each(e.sheetData,function(key, set){
              my_array.push({
                    extend: 'colvisGroup',
                    text: '<span class="tdText"><i class="picons-180"></i> <span id="tText">'+key+'</span></span>',
                    show: set['show'],
                    hide: set['hide'],
                   });
                  
           });

          var sheetData=my_array;

        } else {
          sheetData=[];
        }

  
          var setRouteDelete= setToken({
                  "route"   :e.tabel,
                  "mydiv"   :muId,
                  "typeCrud":e.typeCrud.delete
          });

           $.each(e.typeCrud.update,function(key,value){
              var set=JSON.stringify(value, null, 10);
              Cookies.set('typeCrud_'+key, set, { expires: 10000});
           });

           $.each(e.typeCrud.search,function(key,value){
              var set=JSON.stringify(value, null, 10);
              Cookies.set('typeSearch_'+key, set, { expires: 10000});
           });    
          var setRouteUpdate= setToken({
                  "route"    :e.tabel,
                  "mydiv"    :muId,
                  "typeCrud" :e.typeCrud.update,
                  "from"     :e.typeCrud.from,
          });
          var setRouteInsert= setToken({
                  "route"    :e.tabel,
                  "mydiv"    :muId,
                  "typeCrud" :e.typeCrud.insert,
                  "from"     :e.typeCrud.from,
          });
           var appData='';
            appData=`
            <div id="fromCrud_${muId}" class="bd-b mb-10px pb-10px"></div>
            <div id="fromAction_${muId}"></div>
            <table id="${muId}" class="table"><thead><tr>`;
           $.each(e.tableHead,function(key,value){
              if (value=='No') {
                $sty='style="width: 40px;"';
              } else {
                 $sty='';
              }
              var desainTabel=`<th ${$sty} id="${value}">${value}</th>`;
              appData+=desainTabel;
           });
            appData +=`</tr></thead><tfoot class="${e.headFooter}" align="right"><tr>`;
           $.each(e.tableHead,function(key,value){
               var desainTabel=`<td class="text-right"></td>`;
                appData+=desainTabel;
            });
            appData +=`</tr></tfoot></table>`;
             $(tableObj).before(appData);
            }

          var settings={
                 "autoload"          :hostName+"/api/"+e.tabel,
                 "tabel"             :e.tabel,
                 "ById"              :muId,
                 "fileName"          :e.fileName,
                 'setRouteDelete'    :setRouteDelete,
                 'setRouteUpdate'    :setRouteUpdate,
                 'colomVisible'      :colomVisible,
                 "extend"     :[           
                 {   
                     "extend": 'pdfHtml5',
                     "filename": e.fileNamee,
                      "orientation": 'landscape',
                      "pageSize": 'LEGAL',
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         },
                         
                     }
                 },
                 {   
                     "extend": 'csvHtml5',
                     "filename": e.fileName,
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         }
                     }
                 },
                 {   
                     "extend": 'excelHtml5',
                     "filename": e.fileName,
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         }
                     }
                 },
                 {   
                     "extend": 'print',
                     "filename": e.fileName,
                     "footer": true, 
                     "exportOptions": {
                         "modifier": {
                             "page": 'current'
                         }
                     }
                    }, 
                    {
                       'text': '<span class="tdText p"><i class="picons-143"></i> <span id="tText">Refresh</span></span>',
                        action: function ( e, dt, node, config ) {
                            setReloadDataTable(muId);
                         //$('#'+muId).DataTable().ajax.reload( null, false);
                        },

                    },
                     sheetData,
                    {
                       'text': '<span class="tdText">'+myInsertIcon+'</span>',
                        action: function ( e, dt, node, config ) {
                            if (myInsertStatus=='Insert') {
                              insertTabel(setRouteInsert);  
                            }
                            
                        },
                        
                    },
            ],


           };
            
           if (e.status=='fromAction') {

          $('#fromAction_'+muId).tatiyeNetAppSelectFrom({
                   label        :false,
                   storage      :{
                     'tabel'   :e.tabel,  
                     'content' :'Outside',   //Outside,QuickSend 
                     'az'      :'tl',  
                     'status'  :'deve',  //development
                   },
                   action      :e.fromAction.action
                   
           });
       }
         
           return settings;
    }
    /*
    |--------------------------------------------------------------------------
    | AND TABEL CRUD 
    |--------------------------------------------------------------------------
    */

}(jQuery));
/*
|--------------------------------------------------------------------------
| Initializes deleteTabel 
|--------------------------------------------------------------------------
| Develover Tatiye.Net 2022
| @Date  
*/
function deleteTabel(myToken,initkey,header=''){
   var row=getToken(myToken);
   if (row.typeCrud[1]=='AppModalKey') {
        var starToken= setToken({ 
            "route":row.route, 
            "initkey":initkey, 
            "header":header, 
            "status":row.typeCrud[0],
            "setData" :'Tabel|'+row.mydiv,
          });
        AppModalKeyDelete(starToken);
   } else {
     AppInsideDeleteTabel(row.route,initkey,row.mydiv);
     
   }    
}
/* and class deleteTabel */
/*
|--------------------------------------------------------------------------
| Initializes updateTabel 
|--------------------------------------------------------------------------
| Develover Tatiye.Net 2022
| @Date  
*/
 function updateTabel(myToken,initkey,header=''){
     var row=getToken(myToken);
      if (row.typeCrud[0]=='AppInside') {
           packagePath(row.from,initkey,'fromCrud_'+row.mydiv);
      } else {
         AppModalKey(row.from,initkey,header,row.typeCrud[1]); 
      }
}
/* and class updateTabel */
/*
|--------------------------------------------------------------------------
| Initializes updateTabel 
|--------------------------------------------------------------------------
| Develover Tatiye.Net 2022
| @Date  
*/
 function insertTabel(myToken,initkey='Insert',header='Tambah Data'){
          var row=getToken(myToken);
      if (row.typeCrud[0]=='AppInside') {
           packagePath(row.from,initkey,'fromCrud_'+row.mydiv);
      } else {
           AppModalKey(row.from,initkey,header,row.typeCrud[1]); 
      } 
    
}
/* and class updateTabel */

function AppInsideDeleteTabel(tabel,initkey,setClose,status=''){
     var helper =rest+'/setDelete';
     $.ajax({
            type: 'POST',
            url: autoload,
            data: 'etc='+helper+'&tabel='+tabel+'&initkey='+initkey+'&status='+status,
            datatype: "json",
            async: false,
            success: function(json) {
               $('#'+setClose).DataTable().ajax.reload( null, false);
           }
       }); 
}
function setLinkTabel(token,uid,header='') {
      var ste= getControllerRoute(token);
      // window.location.href =hostName+'/'+domain+'?route='+ste.package;
      packagePath(ste.package,'key','loadbalancer');
   //$("#nugi").html(hostName+'/'+domain+'?route='+ste.package);
}
function setUidModal(token,uid,header='') {
var myToken= setToken({
    "tabel"    :token,
      "initkey"  :uid,
      "header"   :header,
      "syntax"   :{
        'Judul'     :'title',
        'Deskripsi' :'deskripsi',
      }
       });
 setModalNgorey(myToken);
}

/*
|--------------------------------------------------------------------------
| Initializes setTabel Arsip 
|--------------------------------------------------------------------------
| Develover Tatiye.Net 2022
| @Date  
*/
function setTabelArchive(e){
  

      //  $("#contentMenu").html(e.header);


}
/* and class setTabel Arsip */
/*
|--------------------------------------------------------------------------
| Initializes reloadDataTable 
|--------------------------------------------------------------------------
| Develover Tatiye.Net 2022
| @Date  
*/
 function setReloadDataTable(key){
     $('#'+key).DataTable().ajax.reload( null, false);
}
/* and class reloadDataTable */

